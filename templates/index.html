{% extends "base.html" %}
{% block title %}Compare Shows or Movies{% endblock %}

{% block content %}
{% if backdrop_url %}
  <div style="background-image: url('{{ backdrop_url }}'); background-size: cover; background-position: center; height: 240px; border-radius: 8px; margin: 20px auto; max-width: 800px;">
  </div>
{% endif %}

<div class="homepage-cards">

  <!-- Current Viewing Status Card -->
  <div class="card" style="max-width: 400px; margin: 0 auto;">
    <div class="card-header">
      <h2>Currently Watching</h2>
    </div>
    <div class="card-content">
      {% if show_metadata and show_metadata[1] %}
        <div style="text-align: center; margin-bottom: 10px;">
          <img src="{{ show_metadata[1] }}" alt="{{ latest_show }} poster" style="max-height: 200px; border-radius: 4px;">
        </div>
      {% endif %}
      {% if latest_show %}
        <p><strong>Show:</strong> {{ latest_show }}</p>
      {% endif %}
      {% if current_season and current_episode %}
        <p><strong>Season:</strong> {{ current_season }}</p>
        <p><strong>Episode:</strong> {{ current_episode }}</p>
      {% endif %}
      {% if current_user %}
        <p><strong>Username:</strong> {{ current_user }}</p>
      {% endif %}
      <p>You can explore this show's characters and summaries as you watch!</p>

      {% if show_metadata and show_metadata[2] %}
        <p style="margin-top: 15px; font-style: italic;">{{ show_metadata[2] }}</p>
      {% endif %}

      {% if top_characters %}
        <h3>Main Characters</h3>
        <ul>
          {% for character, actor, count in top_characters %}
            <li><strong>{{ character }}</strong> ({{ actor }}) – {{ count }} episodes</li>
          {% endfor %}
        </ul>
      {% endif %}
    </div>
  </div>

</div>

{% if recent_views %}
<div class="recent-plays" style="margin-top: 40px; text-align: center;">
  <h2>Recent Views</h2>
  <ul style="list-style-type: none; padding: 0;">
    {% for item in recent_views %}
      <li style="margin-bottom: 10px;">
        <strong>{{ item.show }}</strong> — Season {{ item.season }}, Episode {{ item.episode }} 
        <br>
        <small style="color: #666;">Viewed by {{ item.username }}</small>
      </li>
    {% endfor %}
  </ul>
</div>
{% endif %}

{% if not latest_show and recent_shows %}
  <div class="recent-shows">
    <h2>Recently Explored Shows</h2>
    <div class="card-grid" style="display: flex; gap: 20px; flex-wrap: wrap; justify-content: center;">
      {% for show in recent_shows %}
        <a href="/show/{{ show | urlencode }}" class="card" style="text-decoration: none; color: inherit; max-width: 200px; background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center;">
          <h3>{{ show }}</h3>
        </a>
      {% endfor %}
    </div>
  </div>
{% endif %}
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/autocomplete.js') }}?v=123"></script>
{% endblock %}